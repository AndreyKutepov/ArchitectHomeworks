# Домашнее задание 4. Микросервисы.

## Кейс

В данном ДЗ продолжу работать над платформой Going Green (ДЗ 1-3 также в этом контексте).

Выделю основные пользовательские сценарии:

* US-1 — Работа с перечнем возможной к приему Б/У техники;. </br> - Аналитик по закупке имеет доступ и возможность к расширению и редактированию базы возможных к приему Б/У товаров; </br> - Клиент может ознакомиться с перечнем типов возможных к приему Б/У товаров;
* US-2 — Формирование критериев приемки Б/У товара. <br/> - Ведущий специалист оценки может формировать и редактировать критерии приемки;
* US-3 — Согласование цены покупки. <br/> - Оценщик по результатам оценки определяет стоимость выкупа электронной техники и предложение падает в ЛК клиенту и прилетает оповещение на почту клиента; </br> - Клиент в личном кабинете системы может согласиться или отказаться от выкупа его техники по оценочной цене;
* US-4 — Оплата покупки Б/У техники клиенту сервиса. <br/> - Клиент, после согласия с предложенной ему ценой выкупа автоматически должен получать на электронный адрес чек-квитанцию с оплатой товара через онлайн-банкинг, таким образом клиент убедится, что оплата поступит к нему в течении некоторого времени; <br/> Клиент получит денежные средства на карту в течение трех рабочих дней с момента подтверждения сделки;

## Описание сервисов

Для описанных сценариев в системе выделено 5 микросервисов:

1) Сервис клиентских данных - Client service (персональные данные, настройки, данные для получения денежных средств и т.д.)
2) Сервис-справочник возможной к приему Б/У техники, рейтинги выкупа, актуальность, средняя цена и пр.
3) Сервис клиентских заявок под сдачу Б/У техники клиентом;
4) Сервис-прослойка (адаптер) для работы с шиной оплаты;
5) Сервис-прослойка (адаптер) интеграции с почтовыми серверами (для отправки писем на эл.адрес);

### Client service

#### Description

Сервис, с которым работает клиент, он агрегирует данных профиля клиента, его настройки, данные для оплаты и получения денежных средств при сдаче Б/У техники;

#### Commands

- Создание нового клиента;
- Редактирование клиентских данных;
- Удаление клиента;
- Создание данных для оплаты клиенту денежных средств;

#### Queries

- Получение данных клиента;

#### Event publish

- Клиент создан;
- Запрос клиента на смену электронного адреса;
- Запрос клиента на смену данных для оплаты;

#### Event consumes

- Все обновления статуса запросов на сдачу техники;
- Подтверждение о выкупе;

#### Dependencies

* Зависимость от сервиса заявок (асинхронное получение статусов обновления данных заявки);
* Зависимость от сервиса-справочника (возможность получения актуальной информации о средней цене выкупа, актуальности сдаваемой техники и т.д.)


### Application service

#### Description

Сервис заявок на сдачу Б/У электонной техники;

#### Commands

- Создание новой заявки на выкуп Б/У техники;
- Согласование/отклонение или любая иная смена статуса заявки;
- Формирование подтверждения о выкупе;

#### Queries

- Получение данных по номеру заявки;
- Получение данных по всем заявкам клиента;

#### Event publish

- Смена статуса заявки;
- Подтверждение выкупа;

#### Event consumes

- N/A

#### Dependencies

* Зависимость от сервиса-справочника (возможность получения актуальной информации о средней цене выкупа, актуальности сдаваемой техники и т.д.)


### Equipment dictionary service

#### Description

Сервис-справочник Б/У электонной техники (средняя цене выкупа, актуальность сдаваемой техники)

#### Commands

- Создание новой позиции Б/У техники;
- Обновление позиции Б/У техники;

#### Queries

- Получение средних данных по типу Б/У электронной техники;
- Получение данных по конкретной модели Б/У техники;

#### Event publish

- N/A

#### Event consumes

- N/A

#### Dependencies

- N/A


### PaymentAdapter service

#### Description

Сервис-прослойка (адаптер) для взаимодействия с шиной оплаты.

#### Commands

- N/A

#### Queries

- N/A

#### Event publish

- Подтверждение произведения оплаты;

#### Event consumes

- Подтверждение выкупа Б/У техники (по получению этого события сервис может осуществить оплату)

#### Dependencies

- Client-service, т.к. необходимо получить данные для оплаты клиенту денежных средств;


### MailAdapter service

#### Description

Сервис-прослойка (адаптер) для взаимодействия с почтовыми SMTP серверами.

#### Commands

- Сформировать письма под каждый consume-event ниже. 

#### Queries

- Получить данные по отправленным письмам клиенту;

#### Event publish

- N/A

#### Event consumes

- Клиент создан;
- Запрос клиента на смену электронного адреса;
- Запрос клиента на смену данных для оплаты;
- Смена статуса заявки;
- Подтверждение произведения оплаты;

#### Dependencies

- Client-service, в некоторых кейсах необходимо будет получить клиентские данные;


Т.к. сложность разрабатываемой системы в данном виде достаточно низкая, то видится, что в настоящее время нет необходимости в реализации микросервисной архитектуры в части бизнес логики (но сервисы-адаптеры я бы обязательно оставил). Сайд=эффекты, которые принесет архитектура в данную реализацию, как по мне, превышают профитов от нее. Я бы пошел по следующему пути - выделил два сервиса (адаптер под шину оплаты и адаптер под интеграцию с почтовыми серверами), а часть, которая несет в себе бизнес-логику на данном этапе разрабатывал в виде **модульного** монолита с оглядкой на описанное выше разбиение на микросервисы.